<div class="cart-page-container">

  <ng-container *ngIf="(items$ | async) as items; else emptyCart">

    <div class="cart-details">
      <h1>My cart</h1>
      
      <div class="cart-items-list">
        <div *ngFor="let item of items" class="cart-item">
          
          <img [src]="item.product.image_url[0]" [alt]="item.product.name" class="item-image">
          
          <div class="item-info">
            <h4>{{ item.product.name }}</h4>
            <p>{{ item.product.price | currency:'USD' }}</p>
            <p>Color: {{ item.color }}</p>
          </div>

          <div class="item-quantity">
            <div class="quantity-controls">
              <button (click)="onDecrement(item)">-</button>
              <span>{{ item.quantity }}</span>
              <button (click)="onIncrement(item)">+</button>
            </div>
          </div>

          <div class="item-total">
            <p>{{ (item.product.price * item.quantity) | currency:'USD' }}</p>
          </div>

          <div class="item-remove">
            <button class="trash-btn" (click)="onRemoveItem(item.id)">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </div>

        </div>
      </div>

      <div class="cart-actions">
        <div class="promo-code-container">
          <div class="action-toggle" *ngIf="!promoCodeVisible">
            <a (click)="togglePromoCode()">
              <span class="material-symbols-outlined">sell</span>
              Enter a promo code
            </a>
          </div>
          <div class="action-input-area" *ngIf="promoCodeVisible">
            <input type="text" placeholder="Enter promo code">
            <button class="apply-btn">Apply</button>
          </div>
        </div>

        <div class="note-container">
          <div class="action-toggle" *ngIf="!noteVisible">
            <a (click)="toggleNote()">
              <span class="material-symbols-outlined">note_add</span>
              Add a note
            </a>
          </div>
          <div class="action-input-area" *ngIf="noteVisible">
            <textarea placeholder="Add a note..."></textarea>
          </div>
        </div>
      </div>

    </div> <div class="order-summary" *ngIf="items.length > 0">
      <h2>Order summary</h2>

      <div class="summary-row">
        <span>Subtotal</span>
        <span>{{ totalPrice$ | async | currency:'USD' }}</span>
      </div>

      <div class="summary-row">
        <a href="#">Estimate Delivery</a>
      </div>

      <div class="summary-total">
        <span>Total</span>
        <strong>{{ totalPrice$ | async | currency:'USD' }}</strong>
      </div>

      <button class="checkout-btn">Checkout</button>
      
      <div class="secure-checkout">
        <span class="material-symbols-outlined">lock</span>
        <span>Secure Checkout</span>
      </div>
    </div>

  </ng-container>

  <ng-template #emptyCart>
    <div class="empty-cart-container">
      <h1>My cart</h1>
      <p>Your cart is empty.</p>
      <a routerLink="/" class="continue-shopping-btn">Continue Shopping</a>
    </div>
  </ng-template>

</div>