@if (product$ | async; as product) {
<div class="details-page-wrapper">
  <div class="page-header">
    <div class="breadcrumbs">
      <a routerLink="/">Home</a>
      <span>/</span>
      <p>{{ product.name }}</p>
    </div>

    <div class="prev-next-nav">
      <a
        (click)="navigateToProduct(prevProductId)"
        [class.disabled]="!prevProductId"
      >
        <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
          <path
            fill="currentColor"
            d="M11.519 13.934c0.214 0.217 0.214 0.566 0 0.783s-0.561 0.217-0.775 0l-6.264-6.326c-0.214-0.217-0.214-0.567 0-0.783l6.264-6.326c0.214-0.217 0.561-0.217 0.775 0s0.214 0.566 0 0.783l-5.712 5.934 5.712 5.934z"
          ></path>
        </svg>
        Prev
      </a>
      <span>|</span>
      <a
        (click)="navigateToProduct(nextProductId)"
        [class.disabled]="!nextProductId"
      >
        Next
        <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
          <path
            fill="currentColor"
            d="M4.48 13.934c-0.214 0.217-0.214 0.566 0 0.783s0.561 0.217 0.775 0l6.264-6.326c0.214-0.217 0.214-0.567 0-0.783l-6.264-6.326c-0.214-0.217-0.561-0.217-0.775 0s-0.214 0.566 0 0.783l5.712 5.934-5.712 5.934z"
          ></path>
        </svg>
      </a>
    </div>
  </div>

  <div class="details-grid">
    <div class="gallery-column">
      <div class="main-image-container">
        <img [src]="selectedImageUrl" [alt]="product.name" />
      </div>
      <div class="thumbnail-container">
        @for (image of product.image_url; track image) {
        <div
          class="thumbnail"
          [class.active]="image === selectedImageUrl"
          (click)="selectImage(image)"
        >
          <img [src]="image" [alt]="product.name" />
        </div>
        }
      </div>
      <div class="bottom-description">
        <p>{{ product.description }}</p>
      </div>
    </div>

    <div class="info-column">
      <h1 class="product-title">{{ product.name }}</h1>
      <p class="sku">SKU: {{ product.sku }}</p>

      <div class="price-container">
        @if (product.sale_price) {
        <span class="sale-price">{{ product.sale_price | currency }}</span>
        <span class="original-price">{{ product.price | currency }}</span>
        } @else {
        <span class="product-price">{{ product.price | currency }}</span>
        }
      </div>

      <div class="color-selector">
        <p class="selector-label">Color: {{ selectedColor }} *</p>
        <div class="color-swatch-wrapper">
          @for (color of product.colors; track color; let i = $index) {
          <div
            class="color-swatch"
            [style.background-color]="color.toLowerCase()"
            [class.selected]="color === selectedColor"
            (click)="selectColor(color, i, product)"
          ></div>
          }
        </div>
      </div>

      <div class="quantity-selector">
        <p class="selector-label">Quantity *</p>
        <div class="quantity-input">
          <button (click)="updateQuantity(-1)">
            <svg
              viewBox="0 0 24 24"
              fill="currentColor"
              width="24"
              height="24"
              class="ssnLU21"
            >
              <path
                fill-rule="evenodd"
                d="M20,12 L20,13 L5,13 L5,12 L20,12 Z"
              ></path>
            </svg>
          </button>
          <span>{{ quantity }}</span>
          <button (click)="updateQuantity(1)">
            <svg
              viewBox="0 0 24 24"
              fill="currentColor"
              width="24"
              height="24"
              class="ssnLU21"
            >
              <path
                fill-rule="evenodd"
                d="M13,5 L13,12 L20,12 L20,13 L13,13 L13,20 L12,20 L11.999,13 L5,13 L5,12 L12,12 L12,5 L13,5 Z"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <button class="add-to-cart-button" (click)="onAddToCart(product)">
        Add to Cart
      </button>

      <div class="accordion">
        <div class="accordion-section">
          <div
            class="accordion-item"
            (click)="toggleAccordion('info')"
            [class.active]="openAccordion === 'info'"
          >
            <span>PRODUCT INFO</span>
            <span class="accordion-icon">
              @if(openAccordion === 'info') {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <g>
                      <g>
                        <g>
                          <g><path d="M0 0L11 0 11 1 0 1z"></path></g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </svg>
              } @else {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <path
                      d="M6 5L6 0 5 0 5 5 0 5 0 6 5 6 5 11 6 11 6 6 11 6 11 5z"
                    ></path>
                  </g>
                </g>
              </svg>
              }
            </span>
          </div>
          <div
            class="accordion-content"
            [class.open]="openAccordion === 'info'"
          >
            <p>
              I'm a product detail. I'm a great place to add more information
              about your product such as sizing, material, care and cleaning
              instructions. This is also a great space to write what makes this
              product special and how your customers can benefit from this item.
            </p>
          </div>
        </div>

        <div class="accordion-section">
          <div
            class="accordion-item"
            (click)="toggleAccordion('refund')"
            [class.active]="openAccordion === 'refund'"
          >
            <span>RETURN & REFUND POLICY</span>
            <span class="accordion-icon">
              @if(openAccordion === 'refund') {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <g>
                      <g>
                        <g>
                          <g><path d="M0 0L11 0 11 1 0 1z"></path></g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </svg>
              } @else {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <path
                      d="M6 5L6 0 5 0 5 5 0 5 0 6 5 6 5 11 6 11 6 6 11 6 11 5z"
                    ></path>
                  </g>
                </g>
              </svg>
              }
            </span>
          </div>
          <div
            class="accordion-content"
            [class.open]="openAccordion === 'refund'"
          >
            <p>
              I’m a Return and Refund policy. I’m a great place to let your
              customers know what to do in case they are dissatisfied with their
              purchase. Having a straightforward refund or exchange policy is a
              great way to build trust and reassure your customers that they can
              buy with confidence.
            </p>
          </div>
        </div>

        <div class="accordion-section">
          <div
            class="accordion-item"
            (click)="toggleAccordion('shipping')"
            [class.active]="openAccordion === 'shipping'"
          >
            <span>SHIPPING INFO</span>
            <span class="accordion-icon">
              @if(openAccordion === 'shipping') {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <g>
                      <g>
                        <g>
                          <g><path d="M0 0L11 0 11 1 0 1z"></path></g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </svg>
              } @else {
              <svg
                viewBox="0 0 15 15"
                fill="currentColor"
                width="15"
                height="15"
              >
                <g>
                  <g>
                    <path
                      d="M6 5L6 0 5 0 5 5 0 5 0 6 5 6 5 11 6 11 6 6 11 6 11 5z"
                    ></path>
                  </g>
                </g>
              </svg>
              }
            </span>
          </div>
          <div
            class="accordion-content"
            [class.open]="openAccordion === 'shipping'"
          >
            <p>
              I'm a shipping policy. I'm a great place to add more information
              about your shipping methods, packaging and cost. Providing
              straightforward information about your shipping policy is a great
              way to build trust and reassure your customers that they can buy
              from you with confidence.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

} @else {
<p class="loading">Loading product...</p>
}
